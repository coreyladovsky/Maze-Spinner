<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>
  </head>
  <body>
    <style media="screen">
      canvas {
      /*border : 5px solid green;*/
    }
      .canvas-container {
        display: flex;
        justify-content: center;
        width: 100%;
        height: 100%;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const canvas = document.querySelector('canvas')
        const ctx = canvas.getContext("2d")
        const draw_reset = () => {

          ctx.font = "30px Arial";
          ctx.fillText("N",330,40);
          ctx.beginPath();
          ctx.arc(348, 360, 315, 0, Math.PI * 2, true)
          ctx.moveTo(110, 110);
          ctx.fillStyle = "yellow"
          ctx.stroke();
          ctx.fill();


          const maze = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,0,0,0,1,0,1,1,0,1,0,0,0,1,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,1,0,1,0,1,0,1,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0],
            [0,0,0,1,1,1,1,0,1,0,1,0,1,0,1,0,0,1,0,1,0,0,0,0,0,0,0,0],
            [0,0,0,1,0,0,0,0,1,0,1,0,1,0,1,0,1,1,0,1,1,1,1,1,0,0,0,0],
            [0,0,0,1,0,1,1,1,1,0,0,0,1,0,0,0,1,0,0,1,0,0,0,1,0,0,0,0],
            [0,0,0,1,0,0,0,0,1,1,1,1,1,1,1,1,1,0,1,0,0,1,0,1,0,0,0,0],
            [0,0,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,0,1,0,1,1,0,1,0,0,0,0],
            [0,0,1,2,2,0,1,0,1,0,1,1,1,1,1,1,1,1,1,0,0,1,0,1,0,0,0,0],
            [0,0,1,1,1,0,1,0,1,0,1,0,0,0,0,1,0,0,0,1,0,1,0,1,0,0,0,0],
            [0,0,0,0,1,0,1,0,1,0,0,0,1,1,0,1,0,1,0,1,0,1,0,1,0,0,0,0],
            [0,0,0,0,1,0,0,0,1,1,1,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0],
            [0,0,0,0,1,1,1,1,1,0,0,0,0,0,1,1,0,1,0,1,0,1,0,1,0,0,0,0],
            [0,0,0,0,0,1,0,0,0,0,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,0,0,0],
            [0,0,0,0,0,1,0,1,1,1,1,0,0,0,0,1,0,1,0,1,0,1,3,1,0,0,0,0],
            [0,0,0,0,0,1,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,3,1,0,0,0,0],
            [0,0,0,0,0,1,0,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,0,0,0],
            [0,0,0,0,0,1,1,1,1,1,0,1,0,1,0,1,0,1,0,0,0,1,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,1,1,1,1,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
          ]
          for(let y = 0; y < maze.length; y++) {
            for(let x = 0; x < maze[y].length; x++) {
              let tile = maze[y][x]
              if(maze[y][x] === 1) {
                ctx.fillStyle = "black";
                ctx.fillRect(x * 25, y * 25, 25, 25)

                if(trueCollisionCheck(mover.run_x, 7, mover.run_y, y * 25, x * 25, 25)) {
                  backwardsStep()
                }
              } else if(maze[y][x] === 2) {
                ctx.fillStyle = "green";
                ctx.fillRect(x * 25, y * 25, 25, 25)
              } else if(maze[y][x] === 3) {
                ctx.fillStyle = "red";
                ctx.fillRect(x * 25, y * 25, 25, 25)
              }
            }
          }




        }

        const mover = {
          run_x: 82,
          run_y: 337,
          last_x: 82,
          last_y: 337,
          ctx,
          start: function() {
            this.updateMover()
            this.ctx.fillStyle = "blue";
            ctx.beginPath();
            ctx.arc(this.run_x, this.run_y, 7, 0, Math.PI * 2, true)
            ctx.moveTo(110, 110);
            ctx.stroke();
            ctx.fill()
            // this.ctx.fillRect(this.run_x, this.run_y, 10, 10)

          },
          revert: function() {
              this.run_x = this.last_x;
              this.run_y = this.last_y;
              this.ctx.fillStyle = "blue";
              ctx.beginPath();
              ctx.arc(this.run_x, this.run_y, 7, 0, Math.PI * 2, true)
              ctx.moveTo(110, 110);
              ctx.stroke();
              ctx.fill()
            },

            movement: {
              left: false,
              right: false,
              up: false,
              down: false
            },


            updateMover: function() {
              if(this.movement.up) {
                if(this.last_y !== this.run_y) {
                  this.last_y = this.run_y
                }
                  this.last_x = this.run_x
                  this.run_y -= 1
              }
              if(this.movement.down) {
                if(this.last_y !== this.run_y) {
                  this.last_y = this.run_y
                }
                  this.last_x = this.run_x
                  this.run_y += 1
              }

              if(this.movement.right) {
                if(mover.last_x !== mover.run_x) {
                  mover.last_x = mover.run_x
                }
                  mover.last_y = mover.run_y
                  mover.run_x += 1
              }
              if(this.movement.left) {
                if(mover.last_x !== mover.run_x) {
                  mover.last_x = mover.run_x
                }
                  mover.last_y = mover.run_y
                  mover.run_x -= 1
              }
          }

        }

        function updateLastX(num) {
          mover.last_x += num
        }

        function updateLastY(num) {
          mover.last_y += num
        }

        function step() {
          ctx.clearRect(0,0, 700, 700)
          draw_reset()
          mover.start()
          requestAnimationFrame(step)
        }

        function backwardsStep() {
          mover.revert()
          // ctx.clearRect(0,0, 700, 700)
          // draw_reset()
        }

        document.addEventListener("keydown", (e) => {
          switch (e.key) {
            case "ArrowUp":
            if(mover.movement.down) {
              mover.movement.down = false
            }
            mover.movement.up = true

              break;
            case "ArrowDown":
            if(mover.movement.up) {
              mover.movement.up = false
            }
            mover.movement.down = true

            break;
            case "ArrowRight":
            if(mover.movement.left) {
              mover.movement.left = false
            }
            mover.movement.right = true

            break;
            case "ArrowLeft":
            if(mover.movement.right) {
              mover.movement.right = false
            }
            mover.movement.left = true

              break;
            default:
            console.log("Quit reading the console and pay attention to the game!");
          }
        })
        step()



        document.addEventListener("keyup", (e) => {
          switch (e.key) {
            case "ArrowUp":
            mover.movement.up = false
              break;
            case "ArrowDown":
            mover.movement.down = false
            break;
            case "ArrowRight":
            mover.movement.right = false
            break;
            case "ArrowLeft":
            mover.movement.left = false
              break;
            default:
            console.log("Quit reading the console and pay attention to the game!");
          }
        })

      })

    </script>

    <div class="canvas-container">
      <canvas id="canvas" width="700" height="700"></canvas>

    </div>
    <script type="text/javascript" src="collision.js"></script>
  </body>
</html>
